---
phase: 2-figma-api
plan: 02
type: execute
---

<objective>
Create the Plugin API and Dev Mode/Codegen knowledge modules — covering the Figma plugin sandbox, SceneNode types, IPC patterns, and the Dev Mode codegen plugin system.

Purpose: Document the two plugin-related APIs (standard plugins and Dev Mode codegen plugins) that Phase 6 (Plugin Development) and Phase 7 (skills) will build on. Correct the manifest confusion identified in the audit.
Output: `knowledge/figma-api-plugin.md` and `knowledge/figma-api-devmode.md`
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/2-figma-api/02-01-SUMMARY.md
@knowledge/README.md

# Source material:
@archive/agent-rewritten-01.md
@archive/initial-agent-audit.md

# Key files from Plan 01 (read for consistency):
@knowledge/figma-api-rest.md

# Verify against current Figma developer documentation:
# - https://developers.figma.com/docs/plugins/
# - https://developers.figma.com/docs/plugins/codegen-plugins/
# - https://developers.figma.com/docs/rest-api/dev-resources-endpoints/

**Key corrections from audit:**
- Codegen plugin manifest must use `editorType: ["dev"]` with `capabilities: ["codegen"]` — NOT `["figma", "figjam"]`
- Dev Resources POST uses `dev_resources` array, not singular `dev_resource`
- Standard plugins and codegen plugins are fundamentally different — separate them clearly

**Module structure convention:** title → purpose → when-to-use → content → cross-references
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create figma-api-plugin.md — Plugin API reference</name>
  <files>knowledge/figma-api-plugin.md</files>
  <action>
Create the authoritative Figma Plugin API reference module covering the plugin sandbox model, SceneNode types, and IPC patterns.

**Must cover:**
1. Plugin architecture:
   - Sandbox model: main thread (plugin code) runs in a sandbox with access to Figma document, UI thread (iframe) runs in browser context
   - Communication: `figma.ui.postMessage()` / `figma.ui.onmessage` for main→UI, `parent.postMessage()` for UI→main
   - Lifecycle: `figma.showUI()`, `figma.closePlugin()`, `figma.on('run', ...)`, `figma.on('close', ...)`
2. manifest.json for standard plugins:
   - `editorType: ["figma"]` or `["figma", "figjam"]` — NOT `["dev"]` (that's codegen)
   - `main`, `ui`, `name`, `id`, `api`, `networkAccess`, `permissions`
   - @create-figma-plugin tooling patterns (if applicable from the production plugin's usage)
3. SceneNode type hierarchy:
   - BaseNode → SceneNode → specific types
   - Key types: DocumentNode, PageNode, FrameNode, GroupNode, ComponentNode, InstanceNode, TextNode, VectorNode, BooleanOperationNode, LineNode, EllipseNode, RectangleNode, StarNode, PolygonNode
   - FrameNode vs GroupNode (layout properties only on FrameNode)
   - ComponentNode vs InstanceNode (mainComponent reference, overrides)
4. Key Plugin API methods:
   - `figma.currentPage`, `figma.root`
   - `figma.getNodeById()`, `figma.getStyleById()`
   - `node.findAll()`, `node.findOne()`, `node.findChildren()`
   - `figma.createFrame()`, `figma.createText()`, `figma.createComponent()`
   - `figma.loadFontAsync()` — required before modifying text
   - `figma.getLocalVariables()`, `figma.getLocalVariableCollections()`
5. Common patterns:
   - Walking the node tree recursively
   - Accessing Auto Layout properties (layoutMode, itemSpacing, paddingLeft/Right/Top/Bottom, primaryAxisAlignItems, counterAxisAlignItems, layoutSizingHorizontal/Vertical)
   - Reading fills, strokes, effects from nodes
   - Exporting nodes as images (`node.exportAsync()`)
   - Plugin data storage (`node.setPluginData()`, `node.getPluginData()`)
6. Constraints:
   - No DOM access in main thread (sandbox)
   - No `fetch()` in main thread — must proxy through UI iframe
   - `figma.loadFontAsync()` required before text modification
   - 30-second timeout for plugin execution (can be extended with user interaction)

**Format:** Follow module structure convention. Use TypeScript types/interfaces that match Figma's typings. Include IPC message pattern examples.

**Do NOT:** Mix codegen plugin concepts into this module (that's figma-api-devmode.md). Do NOT use `editorType: ["dev"]` in standard plugin examples.
  </action>
  <verify>
    - File exists at knowledge/figma-api-plugin.md
    - Contains all 5 sections (title, purpose, when-to-use, content, cross-references)
    - Covers sandbox model, manifest.json (standard plugin), SceneNode types, Plugin API methods, IPC patterns
    - Standard plugin manifest uses editorType: ["figma"] NOT ["dev"] (audit correction)
    - Clearly separates standard plugins from codegen plugins
    - No real API keys or secrets
    - Cross-references figma-api-rest.md and figma-api-devmode.md
  </verify>
  <done>figma-api-plugin.md exists with complete Plugin API reference covering sandbox model, manifest, SceneNode hierarchy, API methods, IPC patterns, and constraints. Standard vs codegen plugins clearly separated.</done>
</task>

<task type="auto">
  <name>Task 2: Create figma-api-devmode.md — Dev Mode & Codegen reference</name>
  <files>knowledge/figma-api-devmode.md</files>
  <action>
Create the authoritative Dev Mode and Codegen Plugin reference module. This covers the Dev Mode experience, codegen plugin system, and Dev Resources API.

**Must cover:**
1. Dev Mode overview:
   - What Dev Mode is (inspect panel for developers)
   - How it surfaces design specs, code snippets, and dev resources
   - Relationship to standard Figma editing mode
2. Codegen plugin system:
   - manifest.json for codegen plugins:
     - `editorType: ["dev"]` — NOT `["figma"]` (CRITICAL audit correction)
     - `capabilities: ["codegen"]`
     - `codegenLanguages: [{ label: "React", value: "react" }, ...]`
   - Codegen API:
     - `figma.codegen.on('generate', callback)` — triggered when user selects a node in Dev Mode
     - Callback receives `{ node: SceneNode, language: string }`
     - Must return `CodegenResult[]` with `{ title, code, language }`
   - No UI iframe for codegen plugins (code appears in inspect panel)
   - Accessing node properties for code generation
3. Dev Resources REST API:
   - `GET /v1/files/:file_key/dev_resources` — list dev resources
   - `POST /v1/dev_resources` — create dev resources (uses `dev_resources` array, NOT singular)
   - `PUT /v1/dev_resources` — update dev resources
   - `DELETE /v1/dev_resources` — delete dev resources
   - Dev resource structure: name, url, file_key, node_id
   - Use cases: linking components to code repos, surfacing generated code URLs, design-to-code traceability
4. Codegen plugin patterns:
   - Reading layout properties for CSS generation
   - Reading visual properties for style generation
   - Generating framework-specific code (React, Vue, HTML)
   - Handling component instances vs definitions
   - Multi-language support in single plugin
5. Dev Mode annotations:
   - Ready for dev status
   - Measurements and spacing
   - How annotations relate to dev resources

**Format:** Follow module structure convention. Include complete manifest.json examples for codegen plugins. Show codegen callback patterns with TypeScript.

**Do NOT:** Confuse standard plugin manifest with codegen manifest. The audit specifically flagged `editorType: ["figma", "figjam"]` being used for codegen — this is WRONG.
  </action>
  <verify>
    - File exists at knowledge/figma-api-devmode.md
    - Contains all 5 sections (title, purpose, when-to-use, content, cross-references)
    - Codegen manifest uses editorType: ["dev"] NOT ["figma"] (audit correction)
    - Dev Resources POST uses dev_resources array NOT singular (audit correction)
    - Covers codegen plugin lifecycle, API, and patterns
    - Covers Dev Resources REST API (CRUD)
    - No real API keys or secrets
    - Cross-references figma-api-rest.md and figma-api-plugin.md
  </verify>
  <done>figma-api-devmode.md exists with complete Dev Mode and Codegen reference covering codegen manifests (correct editorType), codegen API, Dev Resources REST endpoints, and code generation patterns. All audit corrections applied.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Both files exist in knowledge/ directory
- [ ] Both follow the module structure convention
- [ ] Plugin module covers: sandbox model, standard manifest, SceneNode types, API methods, IPC, constraints
- [ ] DevMode module covers: codegen manifest (editorType: ["dev"]), codegen API, Dev Resources REST, patterns
- [ ] Audit corrections applied: correct editorType for codegen, correct Dev Resources POST body
- [ ] No real secrets or API keys
- [ ] Cross-references between all Phase 2 modules are consistent
</verification>

<success_criteria>

- Both knowledge modules created and follow conventions
- Standard plugin vs codegen plugin clearly distinguished (key audit finding)
- Plugin API reference covers full SceneNode hierarchy and common patterns
- Dev Mode reference covers codegen lifecycle and Dev Resources API
- Content is accurate and optimized for Claude Code consumption
</success_criteria>

<output>
After completion, create `.planning/phases/2-figma-api/02-02-SUMMARY.md`
</output>
