---
phase: 03-design-to-code
plan: 04
type: execute
---

<objective>
Create the semantic HTML knowledge module and perform cross-module verification — completing Phase 3 with the final knowledge module that ties layout, visual, typography, and asset extraction into production-quality HTML/CSS output.

Purpose: Enable Claude to generate semantic, accessible HTML from Figma designs using intelligent tag selection, ARIA attributes, and BEM class naming — then verify all 5 design-to-code modules are consistent and cross-referenced.
Output: `knowledge/design-to-code-semantic.md` + cross-module verification
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/3-design-to-code/03-01-SUMMARY.md
@.planning/phases/3-design-to-code/03-02-SUMMARY.md
@.planning/phases/3-design-to-code/03-03-SUMMARY.md

# All sibling modules (for cross-referencing):
@knowledge/design-to-code-layout.md
@knowledge/design-to-code-visual.md
@knowledge/design-to-code-typography.md
@knowledge/design-to-code-assets.md

# Figma API references:
@knowledge/figma-api-rest.md
@knowledge/figma-api-plugin.md

# Source material — the production plugin's semantic + HTML generation:
# READ THESE FILES:
# (reference plugin) src/generation/semantic.ts
# (reference plugin) src/generation/classname.ts
# (reference plugin) src/generation/html.ts
# (reference plugin) src/types/generated.ts

# Archive specs:
@archive/agent-rewritten-01.md

# Module conventions:
@knowledge/README.md

**Established patterns:** ~700-900 line knowledge modules
**Constraining decisions:**
- Phase 1: Module structure convention
- Phase 2: All API modules cross-referenced bidirectionally (maintain this pattern)
- CSS strategy: Tailwind (layout bones) + CSS Custom Properties (tokens) + CSS Modules (skin)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create design-to-code-semantic.md knowledge module</name>
  <files>knowledge/design-to-code-semantic.md</files>
  <action>
Read the production plugin's semantic HTML and class naming source files, then create the authoritative semantic HTML generation knowledge module.

**Source files to read first:**
- (reference plugin) `src/generation/semantic.ts`
- (reference plugin) `src/generation/classname.ts`
- (reference plugin) `src/generation/html.ts`
- (reference plugin) `src/types/generated.ts`

**Must cover:**

1. **Semantic Tag Selection Heuristics**
   - **SemanticContext** class: tracks heading hierarchy and interactive element nesting
   - Default: `<div>` for layout containers (FRAME, GROUP, COMPONENT, INSTANCE)
   - TEXT nodes: analyze content and name for semantic meaning
   - Heading detection: layer name or text content matching patterns → `<h1>` through `<h6>`
   - Single `<h1>` rule: enforce only one h1 per page/component tree
   - Heading hierarchy: must be sequential (h1 → h2 → h3, never h1 → h3)
   - Inside interactive elements: text cannot be headings (browser nests badly)

2. **Interactive Element Detection**
   - Button: layer name matches "button", "btn", "cta" (case-insensitive) AND is a frame/component (not a layout container)
   - Link: layer name matches "link", "anchor" → `<a>` element
   - Input detection: "input", "field", "text-field" → `<input>` or `<textarea>`
   - Form detection: "form" → `<form>` element
   - Exclusion: large layout containers named "Button Group" are NOT buttons themselves

3. **Structural Landmark Elements**
   - "header", "navbar", "navigation" → `<header>` or `<nav>`
   - "footer" → `<footer>`
   - "main", "content" → `<main>`
   - "sidebar", "aside" → `<aside>`
   - "section" → `<section>`
   - "article", "post", "card" → `<article>`

4. **Image & Media Elements**
   - Vector containers (from assets module) → `<img>` with `alt` attribute
   - Image fills → `<img>` or `<div>` with `background-image`
   - Video references → `<video>` element
   - Decision: foreground image (content) → `<img>`, background image (decorative) → CSS `background-image`

5. **BEM Class Naming Convention**
   - Pattern: `.block`, `.block__element`, `.block--modifier`
   - Block: top-level component name (e.g., "card", "hero", "nav")
   - Element: child element with double underscore (e.g., "card__title", "card__image")
   - **Flat hierarchy**: never nest deeper than `block__element` (no `block__element__sub`)
   - Sanitization: lowercase, replace spaces/special chars with hyphens
   - Truncation: long names → 32 character max
   - ClassNameTracker: deduplicates names within a component tree

6. **ARIA Attributes**
   - Buttons: `role="button"` if using non-button element, `aria-label` for icon-only buttons
   - Links: always include `href` (use `#` as placeholder if URL unknown)
   - Images: `alt` attribute — derive from layer name or empty string for decorative
   - Hidden decorative elements: `aria-hidden="true"` for purely visual elements
   - Landmarks: `role="navigation"`, `role="banner"`, `role="contentinfo"` as appropriate
   - Live regions: if content updates dynamically, `aria-live="polite"`

7. **Generated Element Tree Structure**
   - `GeneratedElement` type: `{ tag, className, styles, children, attributes }`
   - Children can be `GeneratedElement[]` or `string` (text content)
   - Attributes include: `href`, `src`, `alt`, `role`, `aria-*`, `data-*`
   - Style object: all CSS properties as camelCase (for React) or kebab-case (for HTML)

8. **Responsive Class Considerations**
   - BEM suffix matching across breakpoint frames
   - Same `__element` suffix → same element at different breakpoints
   - Responsive classes use same base name with media query overrides
   - Variant component class mapping: each variant gets its own BEM block namespace

9. **CSS Generation Integration (Layered Strategy)**
   - Where each property lives in the layered CSS approach:
     - **Tailwind classes**: layout (flex, gap, padding, margin), sizing (w-, h-), positioning
     - **CSS Custom Properties**: design token values (colors, font sizes, spacing)
     - **CSS Modules**: visual styles (backgrounds, borders, shadows, specific component styles)
   - Decision tree for where a CSS property should go

10. **Common Pitfalls**
    - Don't use heading tags for visual size — use CSS for sizing, headings for hierarchy
    - "Button Group" or "Button Container" is a layout element, not a button
    - Links without href are not accessible — always provide href
    - ARIA roles on native elements is redundant (`<button role="button">` is unnecessary)
    - Icon-only interactive elements MUST have aria-label
    - Don't over-nest BEM — `.card__header__title` is wrong, use `.card__title`

**Format:** Follow module structure convention. Include the semantic tag selection decision tree as pseudocode/flowchart. BEM naming examples. ARIA checklist.
  </action>
  <verify>
    - File exists at knowledge/design-to-code-semantic.md
    - Contains all 5 sections (title, purpose, when-to-use, content, cross-references)
    - Semantic tag selection heuristics documented with decision tree
    - Interactive element detection rules clear
    - BEM naming convention documented with flat hierarchy rule
    - ARIA attributes checklist included
    - Layered CSS strategy integration documented
    - Cross-references all 4 sibling modules and API modules
    - No real API keys or secrets
  </verify>
  <done>design-to-code-semantic.md exists with complete semantic HTML generation reference covering tag selection, interactive elements, landmarks, BEM naming, ARIA attributes, and layered CSS integration.</done>
</task>

<task type="auto">
  <name>Task 2: Cross-module verification and consistency check</name>
  <files>
    knowledge/design-to-code-layout.md,
    knowledge/design-to-code-visual.md,
    knowledge/design-to-code-typography.md,
    knowledge/design-to-code-assets.md,
    knowledge/design-to-code-semantic.md
  </files>
  <action>
Read all 5 design-to-code knowledge modules and verify cross-module consistency:

1. **Cross-reference verification**: Each module should reference the others where relevant
   - layout.md → references visual.md (backgrounds), typography.md (text in flex), assets.md (vector containers in layout), semantic.md (structural elements)
   - visual.md → references layout.md (background context), typography.md (text colors), assets.md (image fills)
   - typography.md → references visual.md (text colors from fills), layout.md (text alignment via flex), semantic.md (heading hierarchy)
   - assets.md → references visual.md (image fills), semantic.md (img tags), figma-api-rest.md (export endpoints)
   - semantic.md → references all 4 modules + API modules

2. **Terminology consistency**: Ensure same terms used across modules
   - "sizing modes" (not "sizing behavior" or "layout sizing")
   - "Auto Layout" (not "auto-layout" or "autolayout")
   - "variable binding" (not "variable reference" or "bound variable" inconsistently)

3. **Figma API module back-references**: Verify design-to-code modules reference the correct Phase 2 modules
   - figma-api-rest.md for node structure and image export
   - figma-api-plugin.md for SceneNode types
   - figma-api-variables.md for variable bindings

4. **Fix any missing cross-references or terminology inconsistencies** found during verification.

5. **Update CLAUDE.md** knowledge modules table — change "(coming)" status to actual status for all 5 design-to-code modules.
  </action>
  <verify>
    - All 5 modules have bidirectional cross-references where relevant
    - Terminology is consistent across modules
    - API module back-references are correct
    - CLAUDE.md updated with correct module status
    - No broken references, no missing cross-links
  </verify>
  <done>All 5 design-to-code modules cross-verified for consistency. All cross-references bidirectional. CLAUDE.md updated. Phase 3 complete.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] All 5 design-to-code modules exist in knowledge/
- [ ] All follow module structure convention
- [ ] Cross-references are bidirectional and consistent
- [ ] Terminology consistent across all modules
- [ ] CLAUDE.md updated to reflect completed modules
- [ ] No secrets, no fabricated properties
</verification>

<success_criteria>

- All 5 design-to-code knowledge modules complete
- Semantic HTML module covers tag selection, BEM, ARIA, layered CSS integration
- Cross-module verification passed
- CLAUDE.md updated
- Phase 3: Design-to-Code Knowledge Module complete
</success_criteria>

<output>
After completion, create `.planning/phases/3-design-to-code/03-04-SUMMARY.md`:

# Phase 3 Plan 4: Semantic HTML & Verification Summary

**[Substantive one-liner]**

## Accomplishments

- [Key outcomes]

## Files Created/Modified

- `knowledge/design-to-code-semantic.md` — Description
- Modified: CLAUDE.md — Updated module status
- Modified: Any modules with added cross-references

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Phase 3 complete. Ready for Phase 4 (CSS Strategy & Design Tokens Module).
</output>
